@using coaa_app.Data

<div class="flashcard-view shadow-sm rounded-4 mx-auto mb-4 p-4 animate-flip" style="max-width: 420px; background: linear-gradient(135deg, #f8fafc 80%, #e0e7ef 100%);">
    <div class="d-flex flex-column align-items-center">
        @if (!string.IsNullOrEmpty(Card.Term))
        {
            <div class="flashcard-term mb-2">
                <span class="fw-bold text-primary fs-4">@Card.Term</span>
            </div>
            <div class="flashcard-definition mb-3">
                <span class="text-dark fs-5">@Card.Definition</span>
            </div>
        }
        else
        {
            <div class="flashcard-question mb-2">
                <span class="fw-bold text-primary fs-4">@Card.Question</span>
            </div>
            <div class="flashcard-answer mb-3">
                <button class="btn btn-outline-primary btn-lg px-4 py-2 mt-2" @onclick="ToggleShowAnswer" @ontouchstart="ToggleShowAnswer">
                    <i class="bi bi-eye"></i> @(showAnswer ? "Hide Answer" : "Show Answer")
                </button>
                @if (showAnswer)
                {
                    <div class="mt-3 animate-fade">
                        <span class="text-success fw-semibold fs-5">@Card.Answer</span>
                    </div>
                }
            </div>
        }
        <div class="mt-3 text-muted fst-italic" style="font-size:small;">
            @Card.Details
        </div>
        @if(Card.Images != null && Card.Images.Any())
        {
            <div class="mt-3">
                @foreach (var img in Card.Images)
                {
                    <img src="@img" alt="Flashcard Image" class="img-fluid rounded mb-2" style="object-fit: contain;" />
                }
            </div>
        }
        @if (Card.Tags != null && Card.Tags.Any())
        {
            <div class="mt-2">
                @foreach (var tag in Card.Tags)
                {
                    <span class="badge bg-info text-dark me-1" style="font-size:small;">#@tag</span>
                }
            </div>
        }
    </div>
</div>

<style>
    .flashcard-view {
        box-shadow: 0 8px 24px rgba(0,0,0,0.10);
        border-radius: 1.5rem;
        transition: box-shadow 0.2s;
    }
    .flashcard-view:active {
        box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    }
    .flashcard-term, .flashcard-question {
        letter-spacing: 0.5px;
    }
    .flashcard-definition, .flashcard-answer {
        min-height: 40px;
    }
    .animate-flip {
        animation: flipIn 0.5s cubic-bezier(.68,-0.55,.27,1.55);
    }
    @@keyframes flipIn {
        0% { transform: rotateY(90deg); opacity: 0; }
        100% { transform: rotateY(0deg); opacity: 1; }
    }
    .animate-fade {
        animation: fadeIn 0.4s ease;
    }
    @@keyframes fadeIn {
        0% { opacity: 0; }
        100% { opacity: 1; }
    }
</style>

@code {
    [Parameter]
    public FlashcardJsonItem Card { get; set; }

    private bool showAnswer = false;
    private string lastCardId;

    protected override void OnParametersSet()
    {
        var cardId = Card?.Term ?? Card?.Question ?? "";
        if (cardId != lastCardId)
        {
            showAnswer = false;
            lastCardId = cardId;
        }
    }

    private void ToggleShowAnswer()
    {
        showAnswer = !showAnswer;
    }
}
